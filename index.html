<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Statut Minecraft</title>
  <style>
    body { font-family: Arial, sans-serif; background: #0f172a; color: #e2e8f0; padding: 20px; }
    h1 { color: #38bdf8; text-align: center; }
    .status { font-weight: bold; font-size: 1.5em; margin-bottom: 10px; }
    .online { color: #4ade80; }
    .offline { color: #f87171; }
    .section { background: #1e293b; padding: 15px; border-radius: 8px; margin-bottom: 10px; }
    .section-title { font-weight: bold; color: #38bdf8; margin-bottom: 5px; }
    ul { margin: 0; padding-left: 20px; }
  </style>
</head>
<body>
  <h1>üåç Craxxy5909's Serv</h1>
  <div id="status" class="status offline">Chargement...</div>

  <div class="section">
    <div class="section-title">MOTD :</div>
    <div id="motd">‚Äî</div>
  </div>

  <div class="section">
    <div class="section-title">Version :</div>
    <div id="version">‚Äî</div>
  </div>

  <div class="section">
    <div class="section-title">Joueurs :</div>
    <div id="players">‚Äî</div>
    <ul id="playersList"></ul>
  </div>

  <!-- Sons notifications -->
  <audio id="soundOn"><source src="https://freesound.org/data/previews/522/522425_2550195-lq.mp3" type="audio/mpeg"></audio>
  <audio id="soundOff"><source src="https://freesound.org/data/previews/337/337049_3232293-lq.mp3" type="audio/mpeg"></audio>
  <audio id="soundJoin"><source src="https://freesound.org/data/previews/401/401336_5121236-lq.mp3" type="audio/mpeg"></audio>
  <audio id="soundLeave"><source src="https://freesound.org/data/previews/256/256113_3263906-lq.mp3" type="audio/mpeg"></audio>

  <script>
    const API = 'https://craxxy5909-s-serv.onrender.com/status';
    const statusEl = document.getElementById('status');
    const motdEl = document.getElementById('motd');
    const versionEl = document.getElementById('version');
    const playersEl = document.getElementById('players');
    const playersListEl = document.getElementById('playersList');

    let lastOnline = null;
    let lastPlayers = [];

    const sounds = {
      on: document.getElementById('soundOn'),
      off: document.getElementById('soundOff'),
      join: document.getElementById('soundJoin'),
      leave: document.getElementById('soundLeave')
    };

    if ("Notification" in window && Notification.permission === "default") {
      Notification.requestPermission();
    }

    function notify(type, title, body) {
      if ("Notification" in window && Notification.permission === "granted") {
        new Notification(title, { body });
      }
      if (sounds[type]) {
        sounds[type].currentTime = 0;
        sounds[type].play().catch(()=>{});
      }
    }

    async function fetchStatus() {
      try {
        const res = await fetch(API, { cache: "no-store", mode: "cors" });
        const data = await res.json();

        if (data.online) {
          statusEl.textContent = "‚úÖ EN LIGNE";
          statusEl.className = "status online";

          if (lastOnline === false) {
            notify("on", "Serveur en ligne ‚úÖ", "Craxxy5909's Serv vient de d√©marrer !");
          }

          playersEl.textContent = `${data.players.online} / ${data.players.max}`;
          const currentPlayers = Array.isArray(data.players.sample) ? data.players.sample.map(p => String(p.name)) : [];
          playersListEl.innerHTML = currentPlayers.length > 0
            ? currentPlayers.map(p => `<li>${p}</li>`).join('')
            : '<li>Aucun joueur connect√©</li>';

          currentPlayers.forEach(p => {
            if (!lastPlayers.includes(p)) notify("join", "üë§ Connexion", `${p} est connect√©`);
          });
          lastPlayers.forEach(p => {
            if (!currentPlayers.includes(p)) notify("leave", "üëã D√©connexion", `${p} est d√©connect√©`);
          });
          lastPlayers = currentPlayers;

          motdEl.textContent = String(data.motd);
          versionEl.textContent = String(data.version);

          lastOnline = true;
        } else {
          statusEl.textContent = "‚ùå HORS LIGNE";
          statusEl.className = "status offline";

          if (lastOnline === true) {
            notify("off", "Serveur arr√™t√© ‚ùå", "Craxxy5909's Serv vient de s'√©teindre.");
          }

          motdEl.textContent = "‚Äî";
          versionEl.textContent = "‚Äî";
          playersEl.textContent = "‚Äî";
          playersListEl.innerHTML = "<li>Serveur hors ligne</li>";
          lastOnline = false;
          lastPlayers = [];
        }

      } catch (err) {
        statusEl.textContent = "‚ö†Ô∏è Erreur API";
        statusEl.className = "status offline";
        motdEl.textContent = "‚Äî";
        versionEl.textContent = "‚Äî";
        playersEl.textContent = "‚Äî";
        playersListEl.innerHTML = "<li>Impossible de r√©cup√©rer les infos</li>";
      }
    }

    fetchStatus();
    setInterval(fetchStatus, 15000);
  </script>
</body>
</html>
